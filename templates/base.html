<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Maihlili Paie</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'maihlili': {
              500: '#3055ff', // Le Bleu Vif d'accentuation
              600: '#2A4CE5',
              700: '#2343CC',
              300: '#8C8FFF',
            },
            // Couleurs sp√©cifiques FIGMA
            'fond-clair': '#FFF0F8', // Body clair (Rose)
            'sidebar-clair': '#3055FF', // Sidebar claire (Bleu Vif)
            'fond-sombre': '#1B1B1B', // Body sombre (Gris tr√®s fonc√©)
            'sidebar-sombre': '#282828', // Sidebar sombre (Gris fonc√©)
            'carte-sombre': '#363636', // Carte/Panneau sombre
          }
        }
      }
    }
  </script>
  <style>
    /* -------------------------------------------------------------------------------------------------- */
    /* D√âFINITION DES COULEURS VIA LES VARIABLES CSS (COPIE CONFORME FIGMA)                              */
    /* -------------------------------------------------------------------------------------------------- */
    :root {
      /* Couleurs Claires (PAGE 2) */
      --color-bg-light: #FFF0F8; 
      --color-sidebar-bg-light: #3055FF; 
      --color-card-bg-light: #FFFFFF;
      --color-text-light: #181818;
      --color-text-subtle-light: #6B7280;
      --color-border-light: #E0E0E0;

      /* Sidebar Claires */
      --color-sidebar-text-light: #FFFFFF; 
      --color-sidebar-link-hover-light: #456BFF; /* Bleu plus clair */
      --color-sidebar-link-active-bg-light: #FFFFFF; /* Fond Blanc pour l'actif */
      --color-sidebar-link-active-text-light: #3055FF; /* Texte Bleu Vif pour l'actif */
    }

    [data-theme="dark"] {
      /* Couleurs Sombres (PAGE 4) */
      --color-bg-dark: #1B1B1B; 
      --color-sidebar-bg-dark: #282828; 
      --color-card-bg-dark: #363636; 
      --color-text-dark: #F5F5F5;
      --color-text-subtle-dark: #A0A0A0;
      --color-border-dark: #454545;
      --color-input-bg-dark: #454545; 

      /* Sidebar Sombres */
      --color-sidebar-text-dark: #F5F5F5; 
      --color-sidebar-link-hover-dark: #363636; /* Gris de carte pour le hover/actif */
      --color-sidebar-link-active-bg-dark: #363636; 
      --color-sidebar-link-active-text-dark: #F5F5F5; 
    }

    /* Styles de base pour le body */
    body {
      background-color: var(--color-bg-light);
      color: var(--color-text-light);
      transition: background-color 0.3s, color 0.3s;
    }
    [data-theme="dark"] body {
      background-color: var(--color-bg-dark);
      color: var(--color-text-dark);
    }

    /* 1. Sidebar Background & Default Text Color */
    aside {
        background-color: var(--color-sidebar-bg-light);
        color: var(--color-sidebar-text-light); 
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        transition: background-color 0.3s, color 0.3s;
    }

    [data-theme="dark"] aside {
        background-color: var(--color-sidebar-bg-dark);
        color: var(--color-sidebar-text-dark);
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.4);
    }
    
    /* 2. Cartes/Panneaux (Cards) */
    .card {
        background-color: var(--color-card-bg-light) !important;
        border: 1px solid var(--color-border-light) !important;
        border-radius: 1rem; 
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05) !important;
        transition: background-color 0.3s, border-color 0.3s;
    }
    [data-theme="dark"] .card {
        background-color: var(--color-card-bg-dark) !important;
        border-color: var(--color-border-dark) !important;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4) !important;
    }
    
    /* 3. Navigation Links DANS LA SIDEBAR (AJUSTEMENT CRUCIAL) */
    aside .nav-link {
        padding: 0.75rem; 
        border-radius: 0.75rem; 
        transition: all 0.2s;
        font-weight: 500;
        gap: 0.75rem;
    }
    
    /* LIENS CLAIRS (TEXTE BLANC PAR DEFAUT) */
    aside .nav-link:not(.active) {
        color: var(--color-sidebar-text-light) !important;
    }
    aside .nav-link:not(.active):hover {
        background-color: var(--color-sidebar-link-hover-light) !important;
    }

    /* CLAIR: ACTIF */
    aside .nav-link.active {
        background-color: var(--color-sidebar-link-active-bg-light) !important; /* Blanc */
        color: var(--color-sidebar-link-active-text-light) !important; /* Bleu Vif */
        font-weight: 600;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    /* LIENS SOMBRE (TEXTE BLANC PAR DEFAUT) */
    [data-theme="dark"] aside .nav-link:not(.active) {
        color: var(--color-sidebar-text-dark) !important; 
    }
    [data-theme="dark"] aside .nav-link:not(.active):hover {
        background-color: rgba(255, 255, 255, 0.1) !important; /* L√©ger hover semi-transparent */
    }
    
    /* SOMBRE: ACTIF */
    [data-theme="dark"] aside .nav-link.active {
        background-color: var(--color-sidebar-link-active-bg-dark) !important; /* Gris carte */
        color: var(--color-sidebar-link-active-text-dark) !important; /* Blanc */
        font-weight: 600;
        box-shadow: none;
    }

    /* 4. Gestion des couleurs de texte et bordures pour le mode sombre */
    [data-theme="dark"] .text-gray-800 { color: var(--color-text-dark) !important; }
    [data-theme="dark"] .text-gray-500 { color: var(--color-text-subtle-dark) !important; }
    [data-theme="dark"] .border-gray-200,
    [data-theme="dark"] .border-t { border-color: var(--color-border-dark) !important; }
    
    /* Assure la visibilit√© du texte dans la carte du profil */
    [data-theme="dark"] .user-profile .text-gray-800 { color: var(--color-text-dark) !important; }
    [data-theme="dark"] .user-profile .text-gray-500 { color: var(--color-text-subtle-dark) !important; }

    /* Input styles (pour login.html et autres formulaires) */
    input, select, textarea {
      background-color: var(--color-card-bg-light);
      border-color: var(--color-border-light);
      color: var(--color-text-light);
      transition: background-color 0.3s, border-color 0.3s, color 0.3s;
    }
    [data-theme="dark"] input, 
    [data-theme="dark"] select, 
    [data-theme="dark"] textarea {
      background-color: var(--color-input-bg-dark) !important;
      border-color: var(--color-border-dark) !important;
      color: var(--color-text-dark) !important;
    }
  </style>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/main.min.css" rel="stylesheet">
</head>
<body class="flex min-h-screen" data-theme="light">

  <aside class="w-64 min-h-screen flex flex-col p-4">
    
    <div class="p-2 border-b border-gray-200 mb-6">
      <div class="flex items-center justify-center">
        <a href="{{ url_for('index') }}" class="flex items-center space-x-2">
          <img src="{{ url_for('static', filename='images/maihlili-logo-light.png') }}" alt="Logo Maihlili" class="h-10">
        </a>
      </div>
    </div>
    
    <nav class="flex-1 p-2 space-y-1">
      {% if current_user.is_authenticated %}
        <a href="{{ url_for('index') if current_user.is_manager else url_for('employee_dashboard') }}" 
           class="nav-link flex items-center font-medium">
           <span class="text-lg">üìä</span> Tableau de bord
        </a>
         {% if current_user.is_manager %}
          <a href="{{ url_for('planning') }}" 
             class="nav-link flex items-center font-medium">
            <span class="text-lg">üìÖ</span> Planning
          </a>
          
          <a href="{{ url_for('show_employees') }}" 
             class="nav-link flex items-center font-medium">
            <span class="text-lg">üë•</span> Employ√©s
          </a>
          <a href="{{ url_for('manage_teams') }}" 
             class="nav-link flex items-center font-medium">
            <span class="text-lg">üè¢</span> √âquipes
          </a>
          <a href="{{ url_for('show_shifts') }}" 
             class="nav-link flex items-center font-medium">
            <span class="text-lg">üïê</span> Services
          </a>
          <a href="{{ url_for('assignments') }}" 
             class="nav-link flex items-center font-medium">
            <span class="text-lg">üìã</span> Assignations
          </a>
        {% endif %}
        <a href="{{ url_for('settings') }}" 
           class="nav-link flex items-center font-medium">
          <span class="text-lg">‚öôÔ∏è</span> Param√®tres
        </a>
      {% else %}
        <a href="{{ url_for('login') }}" 
           class="nav-link flex items-center font-medium">
          <span class="text-lg">üîë</span> Connexion
        </a>
        <a href="{{ url_for('register') }}" 
           class="nav-link flex items-center font-medium">
          <span class="text-lg">üìù</span> Inscription
        </a>
      {% endif %}
    </nav>

    {% if current_user.is_authenticated %}
    <div class="p-2 border-t border-gray-200 mt-auto">
      <div class="user-profile flex items-center gap-3 p-3 rounded-xl card">
        <div class="w-10 h-10 bg-maihlili-500 rounded-full flex items-center justify-center text-white text-sm font-bold">
          {{ current_user.username[0].upper() }}
        </div>
        <div class="flex-1">
          <p class="text-sm font-semibold text-gray-800">{{ current_user.username }}</p>
          <p class="text-xs text-gray-500">
            {% if current_user.is_admin %}‚ö° Administrateur
            {% elif current_user.is_manager %}üëë Manager
            {% else %}üë§ Employ√©{% endif %}
          </p>
        </div>
      </div>
      <a href="{{ url_for('logout') }}" 
         class="nav-link flex items-center p-2 rounded-lg text-sm mt-3 font-medium">
        <span class="text-base">üö™</span> D√©connexion
      </a>
    </div>
    {% endif %}
  </aside>

  <main class="flex-1 p-8">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mb-6 space-y-3">
            {% for category, message in messages %}
                <div class="flash-message border-l-4 border-maihlili-500 p-4 rounded-xl shadow-sm card" role="alert">
                    <p class="font-medium text-maihlili-700">{{ message }}</p>
                </div>
            {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </main>

  <button class="theme-toggle fixed bottom-6 right-6 p-4 rounded-full text-2xl cursor-pointer shadow-lg z-50 transition-all duration-300 ease-in-out" id="themeToggle">
    üåô
  </button>

  <script>
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;
    
    // R√©cup√©rer le th√®me sauvegard√©, par d√©faut 'light'
    const savedTheme = localStorage.getItem('maihlili-theme') || 'light';
    body.setAttribute('data-theme', savedTheme);
    updateThemeToggle(savedTheme);
    
    function toggleTheme() {
      const currentTheme = body.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      
      body.setAttribute('data-theme', newTheme);
      localStorage.setItem('maihlili-theme', newTheme);
      updateThemeToggle(newTheme);
    }
    
    function updateThemeToggle(theme) {
      if (theme === 'light') {
        themeToggle.textContent = 'üåô';
        themeToggle.title = 'Passer en mode sombre';
        // Style du bouton en mode clair
        themeToggle.className = 'theme-toggle fixed bottom-6 right-6 p-4 rounded-full text-2xl cursor-pointer shadow-lg z-50 transition-all duration-300 ease-in-out bg-gray-200 text-gray-800 hover:bg-gray-300';
      } else {
        themeToggle.textContent = '‚òÄÔ∏è';
        themeToggle.title = 'Passer en mode clair';
        // Style du bouton en mode sombre (couleur Maihlili)
        themeToggle.className = 'theme-toggle fixed bottom-6 right-6 p-4 rounded-full text-2xl cursor-pointer shadow-lg z-50 transition-all duration-300 ease-in-out bg-maihlili-500 text-white hover:bg-maihlili-600';
      }
    }

    themeToggle.addEventListener('click', toggleTheme);

    document.addEventListener('DOMContentLoaded', function() {
      const currentPath = window.location.pathname;
      const navLinks = document.querySelectorAll('.nav-link');
      
      navLinks.forEach(link => {
        link.classList.remove('active');

        if (link.getAttribute('href') === currentPath) {
          link.classList.add('active');
        }
      });
    });
  </script>
</body>
</html>
