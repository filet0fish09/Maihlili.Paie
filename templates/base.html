<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Maihlili Paie</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            // Couleurs de marque Maihlili (vibrant blue from your config/Figma)
            'maihlili': {
              50: '#EEF2FF',
              100: '#E0E7FF', 
              200: '#C7D2FE',
              300: '#A5B4FC',
              400: '#818CF8',
              500: '#3055ff', // Utilisation de votre 'nouveau-bleu-500' du config
              600: '#2A4CE5', 
              700: '#2343CC',
              800: '#1D3AAA',
              900: '#163188'
            },
            // On conserve l'ancienne palette au cas o√π
            'ancien-maihlili': {
                500: '#4F46E5', 
            }
          }
        }
      }
    }
  </script>
  <style>
    /* -------------------------------------------------------------------------------------------------- */
    /* STYLES GLOBALES & FONTIONNELLES BAS√âES SUR FIGMA                                                    */
    /* -------------------------------------------------------------------------------------------------- */
    :root {
      /* Couleurs Claires (FIGMA PAGE 2) */
      --color-bg-light: #F8F8F8; /* Fond principal */
      --color-sidebar-bg-light: #FFFFFF;
      --color-card-bg-light: #FFFFFF;
      --color-text-light: #181818;
      --color-border-light: #E0E0E0;
      --color-shadow-light: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    [data-theme="dark"] {
      /* Couleurs Sombres (FIGMA PAGE 4) */
      --color-bg-dark: #282828; /* Fond principal (Main Content) */
      --color-sidebar-bg-dark: #1B1B1B; /* Sidebar plus fonc√©e */
      --color-card-bg-dark: #363636; /* Fonds des cartes/panneaux */
      --color-text-dark: #F5F5F5;
      --color-border-dark: #454545;
      --color-input-bg-dark: #454545; /* Fond des inputs */
      --color-shadow-dark: 0 4px 12px rgba(0, 0, 0, 0.4);
    }

    body {
      background-color: var(--color-bg-light);
      color: var(--color-text-light);
      transition: background-color 0.3s, color 0.3s;
    }
    
    [data-theme="dark"] body {
      background-color: var(--color-bg-dark);
      color: var(--color-text-dark);
    }

    /* Sidebar Styles */
    aside {
        background-color: var(--color-sidebar-bg-light);
        border-right: 1px solid var(--color-border-light);
        transition: background-color 0.3s, border-color 0.3s;
    }

    [data-theme="dark"] aside {
        background-color: var(--color-sidebar-bg-dark);
        border-right-color: var(--color-border-dark);
        box-shadow: 2px 0 8px rgba(0, 0, 0, 0.3);
    }
    
    /* Card Styles (including user profile) */
    .card, .bg-white {
        background-color: var(--color-card-bg-light) !important;
        border: 1px solid var(--color-border-light) !important;
        box-shadow: var(--color-shadow-light) !important;
        transition: background-color 0.3s, border-color 0.3s, box-shadow 0.3s;
    }

    [data-theme="dark"] .card,
    [data-theme="dark"] .bg-white {
        background-color: var(--color-card-bg-dark) !important;
        border-color: var(--color-border-dark) !important;
        box-shadow: var(--color-shadow-dark) !important;
    }

    /* Text Colors */
    [data-theme="dark"] .text-gray-800 { color: var(--color-text-dark) !important; }
    [data-theme="dark"] .text-gray-500 { color: #A0A0A0 !important; }
    
    /* Navigation Links */
    .nav-link {
        color: #4B5563;
        transition: all 0.2s;
    }
    .nav-link:hover {
        background-color: #F0F0F0;
        color: var(--tw-colors-maihlili-700);
    }
    .nav-link.active {
        background-color: var(--tw-colors-maihlili-50);
        color: var(--tw-colors-maihlili-700);
        font-weight: 600;
        border-left: 3px solid var(--tw-colors-maihlili-500); /* Accent du Figma */
    }
    
    /* Navigation Links Dark Mode */
    [data-theme="dark"] .nav-link {
        color: var(--color-text-dark) !important;
    }
    [data-theme="dark"] .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.08) !important;
    }
    [data-theme="dark"] .nav-link.active {
        background-color: var(--color-card-bg-dark) !important;
        border-left-color: var(--tw-colors-maihlili-500) !important;
        color: #FFFFFF !important;
    }
    
    /* Input Fields */
    [data-theme="dark"] input, 
    [data-theme="dark"] select, 
    [data-theme="dark"] textarea {
      background-color: var(--color-input-bg-dark) !important;
      border-color: var(--color-border-dark) !important;
      color: var(--color-text-dark) !important;
    }
    
    [data-theme="dark"] input:focus,
    [data-theme="dark"] select:focus,
    [data-theme="dark"] textarea:focus {
        border-color: var(--tw-colors-maihlili-500) !important;
        box-shadow: 0 0 0 3px rgba(48, 85, 255, 0.4) !important;
    }

    /* Flash Messages */
    [data-theme="dark"] .flash-message {
        background-color: var(--color-card-bg-dark) !important;
        border-left-color: var(--tw-colors-maihlili-500) !important;
        color: var(--color-text-dark) !important;
    }

    /* Sticky Header fix for dark mode */
    [data-theme="dark"] .gantt-table thead th:first-child,
    [data-theme="dark"] .gantt-table tbody td:first-child {
        background-color: var(--color-sidebar-bg-dark) !important;
    }
  </style>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/main.min.css" rel="stylesheet">
</head>
<body class="flex min-h-screen" data-theme="light">

  <aside class="w-64 min-h-screen flex flex-col p-4 shadow-xl">
    <div class="p-2 border-b border-gray-200 mb-4">
      <div class="flex items-center justify-center">
        <a href="{{ url_for('index') }}" class="flex items-center space-x-2">
          <span class="text-3xl font-bold text-maihlili-500 tracking-wider">Maihlili Paie</span>
        </a>
      </div>
    </div>
    
    <nav class="flex-1 p-2 space-y-1">
      {% if current_user.is_authenticated %}
        <a href="{{ url_for('index') if current_user.is_manager else url_for('employee_dashboard') }}" 
           class="nav-link flex items-center gap-3 p-3 rounded-lg text-maihlili-600 font-medium">
           <span class="text-lg">üìä</span> Tableau de bord
        </a>
         {% if current_user.is_manager %}
          <a href="{{ url_for('planning') }}" 
             class="nav-link flex items-center gap-3 p-3 rounded-lg text-indigo-600 font-medium">
            <span class="text-lg">üìÖ</span> Planning
          </a>
          
          <a href="{{ url_for('show_employees') }}" 
             class="nav-link flex items-center gap-3 p-3 rounded-lg text-green-600 font-medium">
            <span class="text-lg">üë•</span> Employ√©s
          </a>
          <a href="{{ url_for('manage_teams') }}" 
             class="nav-link flex items-center gap-3 p-3 rounded-lg text-blue-600 font-medium">
            <span class="text-lg">üè¢</span> √âquipes
          </a>
          <a href="{{ url_for('show_shifts') }}" 
             class="nav-link flex items-center gap-3 p-3 rounded-lg text-purple-600 font-medium">
            <span class="text-lg">üïê</span> Services
          </a>
          <a href="{{ url_for('assignments') }}" 
             class="nav-link flex items-center gap-3 p-3 rounded-lg text-orange-600 font-medium">
            <span class="text-lg">üìã</span> Assignations
          </a>
        {% endif %}
        <a href="{{ url_for('settings') }}" 
           class="nav-link flex items-center gap-3 p-3 rounded-lg text-gray-600 font-medium">
          <span class="text-lg">‚öôÔ∏è</span> Param√®tres
        </a>
      {% else %}
        <a href="{{ url_for('login') }}" 
           class="nav-link flex items-center gap-3 p-3 rounded-lg text-maihlili-600 font-medium">
          <span class="text-lg">üîë</span> Connexion
        </a>
        <a href="{{ url_for('register') }}" 
           class="nav-link flex items-center gap-3 p-3 rounded-lg text-green-600 font-medium">
          <span class="text-lg">üìù</span> Inscription
        </a>
      {% endif %}
    </nav>

    {% if current_user.is_authenticated %}
    <div class="p-2 border-t border-gray-200">
      <div class="user-profile flex items-center gap-3 p-3 rounded-xl card">
        <div class="w-10 h-10 bg-maihlili-500 rounded-full flex items-center justify-center text-white text-sm font-bold shadow-md">
          {{ current_user.username[0].upper() }}
        </div>
        <div class="flex-1">
          <p class="text-sm font-semibold text-gray-800">{{ current_user.username }}</p>
          <p class="text-xs text-gray-500">
            {% if current_user.is_admin %}‚ö° Administrateur
            {% elif current_user.is_manager %}üëë Manager
            {% else %}üë§ Employ√©{% endif %}
          </p>
        </div>
      </div>
      <a href="{{ url_for('logout') }}" 
         class="nav-link flex items-center gap-3 p-2 rounded-lg hover:bg-red-50 hover:text-red-700 text-red-600 text-sm mt-3 font-medium">
        <span class="text-base">üö™</span> D√©connexion
      </a>
    </div>
    {% endif %}
  </aside>

  <main class="flex-1 p-8">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mb-6 space-y-3">
            {% for category, message in messages %}
                <div class="flash-message border-l-4 border-maihlili-500 p-4 rounded-lg shadow-sm text-sm bg-white" role="alert">
                    <p class="font-medium text-maihlili-700">{{ message }}</p>
                </div>
            {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </main>

  <button class="theme-toggle fixed bottom-6 right-6 p-4 rounded-full text-2xl cursor-pointer shadow-lg z-50 transition-all duration-300 ease-in-out bg-gray-200 text-gray-800 hover:bg-gray-300" id="themeToggle">
    üåô
  </button>

  <script>
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;
    
    // R√©cup√©rer le th√®me sauvegard√©
    const savedTheme = localStorage.getItem('maihlili-theme') || 'light';
    body.setAttribute('data-theme', savedTheme);
    updateThemeToggle(savedTheme);
    
    function toggleTheme() {
      const currentTheme = body.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      
      body.setAttribute('data-theme', newTheme);
      localStorage.setItem('maihlili-theme', newTheme);
      updateThemeToggle(newTheme);
    }
    
    function updateThemeToggle(theme) {
      const activeColor = body.getAttribute('data-theme') === 'dark' ? 'text-white' : 'text-gray-800';
      
      if (theme === 'light') {
        themeToggle.textContent = 'üåô';
        themeToggle.title = 'Passer en mode sombre';
        themeToggle.className = 'theme-toggle fixed bottom-6 right-6 p-4 rounded-full text-2xl cursor-pointer shadow-lg z-50 transition-all duration-300 ease-in-out bg-gray-200 text-gray-800 hover:bg-gray-300';
      } else {
        themeToggle.textContent = '‚òÄÔ∏è';
        themeToggle.title = 'Passer en mode clair';
        themeToggle.className = 'theme-toggle fixed bottom-6 right-6 p-4 rounded-full text-2xl cursor-pointer shadow-lg z-50 transition-all duration-300 ease-in-out bg-maihlili-500 text-white hover:bg-maihlili-600';
      }
    }

    themeToggle.addEventListener('click', toggleTheme);

    document.addEventListener('DOMContentLoaded', function() {
      const currentPath = window.location.pathname;
      const navLinks = document.querySelectorAll('.nav-link');
      
      navLinks.forEach(link => {
        // Nettoyer les classes actives avant de v√©rifier
        link.classList.remove('active', 'bg-maihlili-50', 'text-maihlili-700', 'font-semibold', 'bg-red-50', 'text-red-700');

        if (link.getAttribute('href') === currentPath) {
          link.classList.add('active');
          if (body.getAttribute('data-theme') === 'dark') {
             link.classList.remove('text-maihlili-700');
             link.classList.add('text-white'); // Texte blanc sur fond sombre actif
          }
        }
      });
    });
  </script>
</body>
</html>
