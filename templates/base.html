<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Maihlili SPV</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
          colors: {
            // Palette Maihlili personnalis√©e (les 3 couleurs)
            'maihlili-blue': { 
                DEFAULT: '#3055ff', // Bleu Vif principal (Accent / Active Badge)
                50: '#E6E9FF', // Bleu tr√®s p√¢le (Active Link Background, comme dans Figma)
                800: '#1D3AAA', // Dark mode sidebar
            },
            'maihlili-cyan': {
                DEFAULT: '#5ce1e6', // Cyan d'accentuation (Highlight icon)
            },
            'maihlili-rose': { 
                DEFAULT: '#fff0f8', // Rose P√¢le (Fond principal LIGHT, comme dans Figma)
            },
          }
        }
      }
    }
  </script>
  
  <style>
    /* -------------------------------------------------------------------------------------------------- */
    /* VARIABLES DE TH√àME (Bas√©es sur le nouveau design Figma)                                         */
    /* -------------------------------------------------------------------------------------------------- */
    :root {
      /* Mode Clair */
      --color-bg-light: #fff0f8; /* Rose P√¢le */
      --color-sidebar-bg-light: white; /* Sidebar Blanche */
      --color-text-primary: #1f2937;
      --color-border-light: #e5e7eb;
      --color-shadow-sidebar: 0 0 20px rgba(0, 0, 0, 0.08); /* Ombre l√©g√®re pour la sidebar */
      --color-bg-light-active: #E6E9FF; /* Bleu tr√®s p√¢le (maihlili-blue-50) */
    }

    [data-theme="dark"] {
      /* Mode Sombre - Dashboard sombre */
      --color-bg-dark: #111827; 
      --color-text-dark: #e5e7eb;
      --color-border-dark: #374151;
      --color-card-bg-dark: #1f2937; 
      /* Mode Sombre - Sidebar Bleu Vif Fonc√© (Deep Indigo) */
      --color-sidebar-bg-dark: #1d3aaa; 
      --color-sidebar-text-dark: #e0e7ff; 
      --color-bg-dark-active: #162a84; /* Fond actif sur le dark blue */
    }

    body {
      background-color: var(--color-bg-light);
      color: var(--color-text-primary);
      transition: all 0.5s ease;
      min-height: 100vh;
      display: flex;
      font-family: 'Inter', sans-serif;
    }
    
    main {
      flex: 1;
      padding: 2.5rem; 
      transition: background-color 0.5s ease;
    }
    
    [data-theme="dark"] body {
        background-color: var(--color-bg-dark);
        color: var(--color-text-dark);
    }
    [data-theme="dark"] main {
        background-color: var(--color-bg-dark);
    }

    /* -------------------------------------------------------------------------------------------------- */
    /* SIDEBAR (ASIDE) - Style √©pur√© et ombr√©                                                         */
    /* -------------------------------------------------------------------------------------------------- */
    aside {
        width: 256px; /* w-64 */
        background: var(--color-sidebar-bg-light);
        box-shadow: var(--color-shadow-sidebar); /* Nouvelle ombre */
        display: flex;
        flex-direction: column;
        border-right: none;
        transition: all 0.5s ease;
        z-index: 10;
    }
    
    [data-theme="dark"] aside {
        background: var(--color-sidebar-bg-dark) !important;
        box-shadow: none !important;
    }
    
    /* Logo Section */
    .logo-container {
        padding: 1.5rem 0;
        display: flex;
        justify-content: center;
    }

    /* ************************************************************ */
    /* STYLE LIENS DE NAVIGATION (Badge Flottant √† Droite - Figma)  */
    /* ************************************************************ */

    .nav-link {
        display: flex;
        align-items: center;
        padding: 0.85rem 1rem;
        border-radius: 12px; 
        font-weight: 500;
        transition: all 0.3s ease;
        text-decoration: none;
        color: #4b5563; /* Gris par d√©faut */
        gap: 0.75rem;
        position: relative; 
        margin-right: -1rem; /* Pour que le badge soit au bord */
        padding-right: 1.5rem;
    }
    
    /* Normal Link Hover - Light Mode */
    .nav-link:hover:not(.selected-link) {
        background-color: #f3f4f6;
        color: var(--color-text-primary);
    }

    /* Active Link (Selected Link) - Light Mode */
    .selected-link {
        background-color: var(--color-bg-light-active) !important; /* Bleu tr√®s p√¢le */
        color: var(--color-text-primary) !important;
        font-weight: 700;
    }
    .selected-link .link-icon {
        color: #3055FF; /* Bleu Vif pour l'ic√¥ne active */
    }
    /* BADGE BLEU VIF ARRONDI √Ä DROITE (Pilule Verticale) */
    .selected-link::after {
        content: '';
        position: absolute;
        right: 0; 
        top: 50%;
        transform: translateY(-50%);
        width: 6px;
        height: 80%; 
        background-color: #3055FF; /* BLEU VIF */
        border-radius: 9999px;
        transition: all 0.3s ease; 
    }
    
    /* Normal Link - Dark Mode */
    [data-theme="dark"] .nav-link {
        color: var(--color-sidebar-text-dark);
        margin-right: 0; 
        padding-right: 1rem;
    }
    [data-theme="dark"] .nav-link:hover:not(.selected-link) {
        background-color: rgba(255, 255, 255, 0.1) !important;
        color: white;
    }
    
    /* Active Link (Selected Link) - Dark Mode */
    [data-theme="dark"] .selected-link {
        background-color: var(--color-bg-dark-active) !important;
        color: white !important;
        font-weight: 700;
    }
    [data-theme="dark"] .selected-link .link-icon {
        color: #5ce1e6 !important; /* CYAN pour l'ic√¥ne dans le dark mode */
    }
    /* BADGE CYAN ARRONDI √Ä DROITE (Pour Dark Mode) */
    [data-theme="dark"] .selected-link::after {
        background-color: #5ce1e6; /* CYAN */
    }


    /* Flash Messages - D√©grad√© Bleu Vif / Cyan */
    .flash-message {
        background: linear-gradient(135deg, #3055ff, #5ce1e6); 
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(48, 85, 255, 0.3);
        font-weight: 600;
        text-align: center;
        max-width: 600px;
        margin: 0 auto 1.5rem auto;
    }
    
    [data-theme="dark"] .flash-message {
        background: linear-gradient(135deg, #5ce1e6, #3055ff); 
        color: #1f2937;
        box-shadow: 0 4px 15px rgba(92, 225, 230, 0.3);
    }
    
    /* Cartes de contenu */
    .card {
        background-color: white;
        border: 1px solid var(--color-border-light);
        border-radius: 1rem;
        padding: 1.5rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        transition: all 0.5s ease;
    }
    
    [data-theme="dark"] .card {
        background-color: #1f2937 !important;
        border-color: var(--color-border-dark) !important;
        box-shadow: none !important;
    }
    
    /* Bouton Theme Toggle */
    .theme-toggle {
        position: fixed; bottom: 2rem; right: 2rem;
        width: 56px; height: 56px;
        border-radius: 50%;
        background: white;
        border: 1px solid #e5e7eb;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        display: flex; align-items: center; justify-content: center;
        cursor: pointer; z-index: 1000; font-size: 1.5rem;
        transition: all 0.3s ease;
    }
    .theme-toggle:hover {
        transform: scale(1.05);
    }
  </style>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/main.min.css" rel="stylesheet">
</head>
<body data-theme="light">

  <aside class="w-64">
    <div class="logo-container">
      <svg width="180" height="40" viewBox="0 0 180 40" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="0" y="0" width="180" height="40" fill="transparent" />
        
        <path d="M12 4C5.373 4 0 9.373 0 16V36H8V16C8 11.582 11.582 8 16 8H24C28.418 8 32 11.582 32 16V36H40V16C40 9.373 34.627 4 28 4H12Z" fill="#3055FF" class="fill-maihlili-blue-default"/>
        
        <path d="M48 28H44V8C44 7.447 44.447 7 45 7H47C47.553 7 48 7.447 48 8V28Z" fill="#5CE1E6" class="fill-maihlili-cyan-default"/>

        <text x="56" y="27" font-family="Inter, sans-serif" font-size="20" font-weight="900" fill="#1F2937">
          Maihlili
        </text>
        <text x="140" y="27" font-family="Inter, sans-serif" font-size="20" font-weight="500" fill="#3055FF">
          SPV
        </text>
      </svg>
    </div>
    
    <nav class="flex-1 p-4 space-y-2">
      {% if current_user.is_authenticated %}
        
        <a href="{{ url_for('index') if current_user.is_manager else url_for('employee_dashboard') }}" 
           class="nav-link" data-path="{% if current_user.is_manager %}{{ url_for('index') }}{% else %}{{ url_for('employee_dashboard') }}{% endif %}">
            <span class="text-lg link-icon">üìä</span> Planning
        </a>
          {% if current_user.is_manager %}
           <a href="{{ url_for('planning') }}" 
              class="nav-link" data-path="{{ url_for('planning') }}">
             <span class="text-lg link-icon">üìÖ</span> Planning Avanc√©
           </a>
           
           <a href="{{ url_for('show_employees') }}" 
              class="nav-link" data-path="{{ url_for('show_employees') }}">
             <span class="text-lg link-icon">üë•</span> Employ√©s
           </a>
           <a href="{{ url_for('manage_teams') }}" 
              class="nav-link" data-path="{{ url_for('manage_teams') }}">
             <span class="text-lg link-icon">üè¢</span> √âquipes
           </a>
           <a href="{{ url_for('show_shifts') }}" 
              class="nav-link" data-path="{{ url_for('show_shifts') }}">
             <span class="text-lg link-icon">üïê</span> Services
           </a>
           <a href="{{ url_for('assignments') }}" 
              class="nav-link" data-path="{{ url_for('assignments') }}">
             <span class="text-lg link-icon">üìã</span> Assignations
           </a>
         {% endif %}
         <a href="{{ url_for('settings') }}" 
            class="nav-link" data-path="{{ url_for('settings') }}">
           <span class="text-lg link-icon">‚öôÔ∏è</span> Param√®tres
         </a>
      {% else %}
        <a href="{{ url_for('login') }}" 
           class="nav-link" data-path="{{ url_for('login') }}">
          <span class="text-lg link-icon">üîë</span> Connexion
        </a>
        <a href="{{ url_for('register') }}" 
           class="nav-link" data-path="{{ url_for('register') }}">
          <span class="text-lg link-icon">üìù</span> Inscription
        </a>
      {% endif %}
    </nav>

    {% if current_user.is_authenticated %}
    <div class="p-4 border-t border-gray-100 dark:border-gray-700">
      <div class="user-profile flex items-center gap-3 bg-gray-50 dark:bg-maihlili-blue-800 p-3 rounded-xl shadow-inner">
        <div class="w-10 h-10 bg-gradient-to-br from-maihlili-blue to-maihlili-cyan rounded-full flex items-center justify-center text-white text-base font-bold shadow-md flex-shrink-0">
          {{ current_user.username[0].upper() }}
        </div>
        <div class="flex-1 overflow-hidden">
          <p class="text-sm font-extrabold text-gray-800 dark:text-gray-100 truncate">{{ current_user.username }}</p>
          <p class="text-xs text-gray-500 dark:text-gray-300 font-medium">
            {% if current_user.is_admin %}‚ö° Admin
            {% elif current_user.is_manager %}üëë Manager
            {% else %}üë§ Employ√©{% endif %}
          </p>
        </div>
      </div>
      <a href="{{ url_for('logout') }}" 
         class="nav-link flex items-center gap-3 p-3 rounded-xl hover:bg-red-50 hover:text-red-700 text-red-600 text-sm mt-3 font-medium transition-all duration-200">
        <span class="text-base">üö™</span> D√©connexion
      </a>
    </div>
    {% endif %}
  </aside>

  <main>
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul class="mb-6">
          {% for msg in messages %}
            <li class="flash-message mb-2 shadow-xl">
              <span class="font-bold">‚ÑπÔ∏è Information:</span> {{ msg }}
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </main>

  <button class="theme-toggle" id="themeToggle">
    üåô
  </button>

  <script>
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;
    
    // R√©cup√©rer le th√®me sauvegard√©
    const savedTheme = localStorage.getItem('maihlili-theme') || 'light';
    body.setAttribute('data-theme', savedTheme);
    updateThemeToggle(savedTheme);
    
    function toggleTheme() {
      const currentTheme = body.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      
      body.setAttribute('data-theme', newTheme);
      localStorage.setItem('maihlili-theme', newTheme);
      updateThemeToggle(newTheme);
    }
    
    function updateThemeToggle(theme) {
      const toggleButton = document.getElementById('themeToggle');
      if (theme === 'light') {
        toggleButton.innerHTML = 'üåô';
        toggleButton.title = 'Passer en mode sombre';
      } else {
        toggleButton.innerHTML = '‚òÄÔ∏è';
        toggleButton.title = 'Passer en mode clair';
      }
    }

    themeToggle.addEventListener('click', toggleTheme);

    document.addEventListener('DOMContentLoaded', function() {
      // Nettoyage de l'URL pour ne garder que le chemin de base
      let currentPath = window.location.pathname.replace(/\/$/, '');
      if (currentPath === '') {
          currentPath = '/';
      }
      
      const navLinks = document.querySelectorAll('.nav-link');
      
      navLinks.forEach(link => {
        // Comparaison avec l'attribut data-path
        let linkPath = link.getAttribute('data-path').replace(/\/$/, '');
        if (linkPath === '') {
            linkPath = '/';
        }
        
        // Logique de s√©lection pour le dashboard par d√©faut
        const isDefaultDashboard = (linkPath === '/' || linkPath === '/employee-dashboard') && (currentPath === '/' || currentPath === '/employee-dashboard');
        
        if (linkPath === currentPath || isDefaultDashboard) {
          link.classList.add('selected-link');
        } else {
          // S'assurer qu'ils n'ont pas la classe si non actifs
          link.classList.remove('selected-link');
        }
      });
    });
  </script>
</body>
</html>
