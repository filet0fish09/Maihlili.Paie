<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Maihlili SPV</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    /* NOUVEAUX STYLES POUR LES ICONES (Emojis ou SVG) */
    .icon-container {
        font-size: 1.5rem; 
        line-height: 1;
        width: 1.5rem; 
        height: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        color: inherit; 
    }
    
    /* Styles pour la barre de navigation */
    .nav-link-group {
        display: flex;
        align-items: center;
        width: 100%;
        height: 48px; 
        text-decoration: none;
        padding-left: 0.5rem; 
    }
    
    /* ************************************************************ */
    /* NOUVEAUX STYLES MINIMALISTES ET √âPUR√âS                       */
    /* ************************************************************ */

    /* Style du lien (Pilule Blanche sur Sidebar Blanche) */
    .minimal-link {
        flex-grow: 1; 
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: flex-start;
        padding: 0 1.5rem;
        border-radius: 12px; /* Arrondi mod√©r√© */
        background-color: transparent; /* Transparent sur fond blanc */
        color: #3055ff; /* Texte en BLEU VIF (Inactif) */
        font-weight: 600;
        text-align: left;
        box-shadow: none; 
        transition: all 0.2s ease;
    }

    /* Style de l'√©l√©ment s√©lectionn√© (CYAN Maihlili) */
    .minimal-selected .minimal-link {
        background-color: #5ce1e6 !important; /* CYAN pour l'√©tat ACTIF */
        color: #3055ff !important; /* Texte en BLEU VIF */
        font-weight: 700;
        box-shadow: 0 4px 10px rgba(92, 225, 230, 0.3); /* Ombre de couleur Cyan */
    }

    /* Ic√¥ne de l'√©l√©ment s√©lectionn√© */
    .minimal-selected .icon-container {
        color: #3055ff !important; /* BLEU VIF */
    }

    /* Survol des liens non s√©lectionn√©s */
    .minimal-link:hover:not(.minimal-selected .minimal-link) {
        background-color: rgba(48, 85, 255, 0.05) !important; /* L√©ger fond bleu au survol */
        color: #3055ff !important;
    }

    /* ************************************************************ */
    /* Bouton D√©connexion (Bleu Vif sur fond Blanc)                 */
    /* ************************************************************ */
    .logout-button {
      background-color: #3055ff; /* BLEU VIF */
      color: white; 
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(48, 85, 255, 0.4);
    }
    .logout-button:hover {
      background-color: #2a4ce5; 
    }
    /* Ic√¥ne de d√©connexion en Cyan pour l'accentuation */
    .logout-button svg {
      color: #5ce1e6;
    }

  </style>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'maihlili-blue': { 
                DEFAULT: '#3055ff', // Bleu Vif
            },
            'maihlili-cyan': {
                DEFAULT: '#5ce1e6', // Cyan
            },
            'maihlili-rose': { 
                DEFAULT: '#fff0f8', // Rose P√¢le (Fond principal)
            },
          }
        }
      }
    }
  </script>
  <style>
    /* -------------------------------------------------------------------------------------------------- */
    /* Fond de Page et Sidebar                                                                            */
    /* -------------------------------------------------------------------------------------------------- */
    
    body {
      background-color: #fff0f8; /* Le fond du BODY est ROSE P√ÇLE (Tr√®s clair) */
      color: #1f2937;
      font-family: 'Inter', sans-serif;
    }

    main {
      background-color: #fff0f8; /* Le contenu principal est ROSE P√ÇLE */
      padding: 2.5rem; 
    }

    /* ************************************************************ */
    /* ASIDE en BLANC PUR (Minimaliste)                             */
    /* ************************************************************ */
    aside {
        /* Sidebar en BLANC PUR */
        background: white !important; 
        box-shadow: 5px 0 20px rgba(0, 0, 0, 0.05); /* Ombre tr√®s l√©g√®re */
        border-radius: 0 16px 16px 0 !important; /* Arrondi sur le bord droit */
        padding: 0; 
        min-height: 100vh;
    }
    
    /* Bloc Logo - Texte BLEU VIF sur fond Blanc */
    .logo-container {
      background-color: transparent !important;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05); /* Ligne de s√©paration subtile */
    }

    .logo-text {
        font-weight: 800;
        color: #3055ff; /* Texte BLEU VIF */
        letter-spacing: -0.02em; 
    }

    /* Profil Utilisateur (L√©ger fond Bleu) */
    .sidebar-user-profile {
        background-color: rgba(48, 85, 255, 0.05) !important; /* L√©ger fond Bleu */
        color: #3055ff !important; 
        border-radius: 12px;
        font-weight: 600;
    }
    .sidebar-user-profile svg {
        color: #5ce1e6 !important; /* Ic√¥ne Cyan */
    }
    
    /* Contenu interne de la sidebar */
    .sidebar-content {
      padding: 1rem 1.5rem;
    }

  </style>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/main.min.css" rel="stylesheet">
</head>
<body class="flex min-h-screen" data-theme="light"> 

  <aside class="w-[300px] flex flex-col"> 
    
    <div class="h-[100px] flex items-center p-4 logo-container"> 
      <div class="w-12 h-12 rounded-full bg-maihlili-rose flex items-center justify-center border-2 border-maihlili-blue">
        <img src="{{ url_for('static', filename='images/maihlili-logo-light.png') }}" alt="Logo Maihlili clair" class="h-10 w-10 rounded-full">
      </div>
      <div class="ml-3 flex flex-col leading-tight logo-text uppercase">
        <span class="text-xl">Maihlili.</span>
        <span class="text-xl font-medium">Paie</span>
      </div>
    </div>

    <div class="flex-1 flex flex-col justify-between sidebar-content"> 
      
      <nav class="space-y-2">
        {% if current_user.is_authenticated %}
          {% set menu_items_data = [
            ('üìä', 'Planning', url_for('index') if current_user.is_manager else url_for('employee_dashboard'), current_user.is_authenticated),
            ('üìÖ', 'Planning Avanc√©', url_for('planning'), current_user.is_manager),
            ('üë•', 'Employ√©s', url_for('show_employees'), current_user.is_manager),
            ('üè¢', '√âquipes', url_for('manage_teams'), current_user.is_manager),
            ('‚è±Ô∏è', 'Services', url_for('show_shifts'), current_user.is_manager),
            ('üìã', 'Assignations', url_for('assignments'), current_user.is_manager),
            ('‚öôÔ∏è', 'Param√®tres', url_for('settings'), current_user.is_authenticated)
          ] %}

          {% for emoji, label, url, condition in menu_items_data %}
            {% if condition %}
            <a href="{{ url }}" 
               class="nav-link-group {% if loop.index == 1 %} minimal-selected {% endif %}"> 
              
              <span class="icon-container text-maihlili-blue">{{ emoji | safe }}</span> 
              
              <span class="minimal-link text-base">{{ label }}</span> 
            </a>
            {% endif %}
          {% endfor %}
        
        {% else %}
          <a href="{{ url_for('login') }}" class="nav-link-group">
            <span class="icon-container text-maihlili-blue">üîë</span>
            <span class="minimal-link text-base">Connexion</span>
          </a>
          <a href="{{ url_for('register') }}" class="nav-link-group">
            <span class="icon-container text-maihlili-blue">üìù</span>
            <span class="minimal-link text-base">Inscription</span>
          </a>
        {% endif %}
      </nav>
      
      <div class="mt-8"> 
        
        {% if current_user.is_authenticated %}
        <div class="user-profile flex items-center p-3 sidebar-user-profile" style="height: 65px;"> 
          <div class="w-10 h-10 bg-maihlili-cyan rounded-full flex items-center justify-center text-xl font-bold">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M17.982 4.743A9.522 9.522 0 0 0 12 3.5c-4.972 0-9 4.028-9 9s4.028 9 9 9 9-4.028 9-9c0-.448-.046-.889-.138-1.32" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 12a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M15.406 20.088c-1.691-.715-3.593-1.088-5.406-1.088-1.813 0-3.715.373-5.406 1.088a1.5 1.5 0 0 0-.844 1.341c0 .828.672 1.5 1.5 1.5h9.75a1.5 1.5 0 0 0 1.5-1.5 1.5 1.5 0 0 0-.844-1.341Z" />
            </svg>
          </div>
          <div class="flex-1 ml-3">
            <p class="text-base font-bold">{{ current_user.username }}</p> 
            <p class="text-xs font-medium -mt-1 text-gray-500">
              {% if current_user.is_admin %}Admin
              {% elif current_user.is_manager %}Manager
              {% else %}Employ√©{% endif %}
            </p>
          </div>
        </div>
        
        <a href="{{ url_for('logout') }}" 
           class="flex items-center justify-center p-3 transition-all duration-200 logout-button mt-4"
           style="height: 45px;"> 
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 mr-2 -translate-y-0.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6A2.25 2.25 0 0 0 5.25 5.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l3 3m0 0-3 3m3-3H6" />
          </svg>
          <span class="text-base font-bold">Se D√©connecter</span>
        </a>
        {% endif %}
      </div>
    </div>
  </aside>

  <main class="flex-1"> {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul class="mb-4">
          {% for msg in messages %}
            <li class="bg-gradient-to-r from-maihlili-100 to-maihlili-50 border border-maihlili-200 text-maihlili-700 px-4 py-3 rounded-lg mb-2 shadow-sm">
              <span class="font-medium">‚ÑπÔ∏è</span> {{ msg }}
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </main>

  <button class="theme-toggle" id="themeToggle">
    üåô
  </button>

  <script>
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;
    
    // R√©cup√©rer le th√®me sauvegard√©
    const savedTheme = localStorage.getItem('maihlili-theme') || 'light';
    body.setAttribute('data-theme', savedTheme);
    updateThemeToggle(savedTheme);
    
    function toggleTheme() {
      const currentTheme = body.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      
      body.setAttribute('data-theme', newTheme);
      localStorage.setItem('maihlili-theme', newTheme);
      updateThemeToggle(newTheme);
    }
    
    function updateThemeToggle(theme) {
      if (theme === 'light') {
        themeToggle.textContent = 'üåô';
        themeToggle.title = 'Passer en mode sombre';
      } else {
        themeToggle.textContent = '‚òÄÔ∏è';
        themeToggle.title = 'Passer en mode clair';
      }
    }

    themeToggle.addEventListener('click', toggleTheme);

    document.addEventListener('DOMContentLoaded', function() {
      const currentPath = window.location.pathname;
      const navLinks = document.querySelectorAll('.nav-link-group'); 

      navLinks.forEach(link => {
        const linkURL = link.getAttribute('href');
        const label = link.querySelector('.minimal-link');
        const icon = link.querySelector('.icon-container');
        
        // 1. G√©rer la s√©lection (Cyan)
        const isDefaultSelected = icon.textContent.trim() === 'üìä' && 
                                  (currentPath === '/' || currentPath.endsWith('/employee-dashboard') || currentPath.endsWith('/'));
        
        const isSelected = (linkURL === currentPath) || isDefaultSelected;

        if (isSelected) {
          link.classList.add('minimal-selected');
        } else {
          link.classList.remove('minimal-selected');
        }

        // 2. G√©rer l'effet de survol (fond tr√®s l√©ger)
        if (label) {
            link.addEventListener('mouseenter', function() {
                if (!link.classList.contains('minimal-selected')) {
                    label.style.backgroundColor = 'rgba(48, 85, 255, 0.05)'; 
                }
            });
            link.addEventListener('mouseleave', function() {
                if (!link.classList.contains('minimal-selected')) {
                    label.style.backgroundColor = 'transparent';
                }
            });
        }
      });
    });
  </script>
</body>
</html>
