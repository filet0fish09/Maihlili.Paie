<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Maihlili Paie</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            // Palette de couleurs personnalis√©e
            'maihlili': {
              // Nous d√©finissons ici les couleurs principales selon vos derni√®res instructions
              // La couleur d'accentuation principale (500) est #3055FF (Bleu Vif)
              // La couleur de fond/accentuation secondaire est #FFF0F8 (Rose Clair)
              50: '#E6E9FF',
              100: '#C8CEFF', 
              200: '#AAAEFF',
              300: '#8C8FFF',
              400: '#6E71FF',
              500: '#3055ff', // Le bleu vif de la sidebar
              600: '#2A4CE5', 
              700: '#2343CC',
              800: '#1D3AAA',
              900: '#163188'
            },
            'rose-maihlili': {
                100: '#FFF0F8', // Le fond principal et l'accentuation
                200: '#FFDCEF',
            }
          }
        }
      }
    }
  </script>
  <style>
    /* -------------------------------------------------------------------------------------------------- */
    /* STYLES GLOBALES & COULEURS STRICTEMENT BAS√âES SUR VOS DERNI√àRES INSTRUCTIONS                        */
    /* -------------------------------------------------------------------------------------------------- */
    :root {
      /* Couleurs Claires (Mode Clair Actuel) */
      --color-bg-light: #FFF0F8; /* Body : FFF0F8 */
      --color-sidebar-bg-light: #3055FF; /* Sidebar : 3055FF */
      --color-card-bg-light: #FFFFFF;
      --color-text-light: #181818;
      --color-text-subtle-light: #6B7280;
      --color-border-light: #E0E0E0;

      /* Couleurs Sidebar */
      --color-sidebar-text: #FFFFFF; /* Texte blanc sur fond bleu */
      --color-sidebar-link-hover: #456BFF; /* Bleu l√©g√®rement plus clair */
      --color-sidebar-link-active: #FFFFFF; /* Fond de l'actif (Rose Clair) */
    }

    /* -------------------------------------------------------------------------------------------------- */
    /* MODE SOMBRE (R√©initialis√©, car non demand√© pour l'instant)                                         */
    /* -------------------------------------------------------------------------------------------------- */
    [data-theme="dark"] {
      --color-bg-dark: #282828; 
      --color-sidebar-bg-dark: #1B1B1B; 
      --color-card-bg-dark: #363636; 
      --color-text-dark: #F5F5F5;
      --color-text-subtle-dark: #A0A0A0;
      --color-border-dark: #454545;
      --color-input-bg-dark: #454545; 
      --color-sidebar-text: #F5F5F5; 
      --color-sidebar-link-hover: #363636;
      --color-sidebar-link-active: #454545; 
    }

    body {
      background-color: var(--color-bg-light);
      color: var(--color-text-light);
      transition: background-color 0.3s, color 0.3s;
    }
    
    [data-theme="dark"] body {
      background-color: var(--color-bg-dark);
      color: var(--color-text-dark);
    }

    /* 1. Sidebar (Bleu Vif) */
    aside {
        background-color: var(--color-sidebar-bg-light);
        border-right: none; 
        transition: background-color 0.3s;
        color: var(--color-sidebar-text); /* Texte blanc par d√©faut */
    }

    [data-theme="dark"] aside {
        background-color: var(--color-sidebar-bg-dark);
        border-right-color: var(--color-border-dark);
        box-shadow: 2px 0 8px rgba(0, 0, 0, 0.3);
    }
    
    /* 2. Cartes & Conteneurs (Pas de changement de couleur pour le mode clair ici) */
    .card, .bg-white {
        background-color: var(--color-card-bg-light) !important;
        border: 1px solid var(--color-border-light) !important;
        border-radius: 1rem; 
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05) !important;
        transition: background-color 0.3s, border-color 0.3s;
    }

    [data-theme="dark"] .card,
    [data-theme="dark"] .bg-white {
        background-color: var(--color-card-bg-dark) !important;
        border-color: var(--color-border-dark) !important;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4) !important;
    }
    
    /* 3. Navigation Links DANS LA SIDEBAR (Texte blanc par d√©faut) */
    aside .nav-link {
        color: var(--color-sidebar-text) !important;
        padding: 0.75rem; 
        border-radius: 0.75rem; 
        transition: all 0.2s;
    }
    
    aside .nav-link:hover {
        background-color: var(--color-sidebar-link-hover) !important; /* Bleu l√©g√®rement plus clair */
    }
    
    /* L'√©l√©ment actif a un fond Rose Clair (#FFF0F8) et le texte doit √™tre le Bleu Maihlili Vif */
    aside .nav-link.active {
        background-color: var(--color-sidebar-link-active) !important; /* Fond Blanc */
        color: var(--tw-colors-maihlili-500) !important; /* Texte Bleu Vif */
        font-weight: 600;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    /* 4. Texte et Bordures du Main Content (hors Sidebar) */
    [data-theme="dark"] .text-gray-800 { color: var(--color-text-dark) !important; }
    [data-theme="dark"] .text-gray-500 { color: var(--color-text-subtle-dark) !important; }
    [data-theme="dark"] .border-gray-200,
    [data-theme="dark"] .border-t { border-color: var(--color-border-dark) !important; }

    /* 5. Logo et Titre (Couleur blanche sur fond bleu de la sidebar) */
    aside .text-maihlili-500 {
        color: white !important; /* Pour le titre "Maihlili Paie" si on n'utilise pas l'image du logo pour le texte */
    }

    aside .border-b {
        border-color: rgba(255, 255, 255, 0.2) !important; /* S√©parateur l√©ger dans la sidebar */
    }
    
    /* Logo: on utilise uniquement le logo clair sur fond sombre */
    .logo-light { display: block; }
    .logo-dark { display: none; }
    [data-theme="dark"] .logo-light { display: none; }
    [data-theme="dark"] .logo-dark { display: block; }
  </style>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/main.min.css" rel="stylesheet">
</head>
<body class="flex min-h-screen" data-theme="light">

  <aside class="w-64 min-h-screen flex flex-col p-4 shadow-xl">
    
    <div class="p-2 border-b border-gray-200 mb-6">
      <div class="flex items-center justify-center">
        <a href="{{ url_for('index') }}" class="flex items-center space-x-2">
          <img src="{{ url_for('static', filename='images/maihlili-logo-light.png') }}" alt="Logo Maihlili clair" class="h-10 logo-light">
          <span class="text-2xl font-bold tracking-wider logo-dark">Maihlili Paie</span>
        </a>
      </div>
    </div>
    
    <nav class="flex-1 p-2 space-y-1">
      {% if current_user.is_authenticated %}
        <a href="{{ url_for('index') if current_user.is_manager else url_for('employee_dashboard') }}" 
           class="nav-link flex items-center gap-3 font-medium">
           <span class="text-lg">üìä</span> Tableau de bord
        </a>
         {% if current_user.is_manager %}
          <a href="{{ url_for('planning') }}" 
             class="nav-link flex items-center gap-3 font-medium">
            <span class="text-lg">üìÖ</span> Planning
          </a>
          
          <a href="{{ url_for('show_employees') }}" 
             class="nav-link flex items-center gap-3 font-medium">
            <span class="text-lg">üë•</span> Employ√©s
          </a>
          <a href="{{ url_for('manage_teams') }}" 
             class="nav-link flex items-center gap-3 font-medium">
            <span class="text-lg">üè¢</span> √âquipes
          </a>
          <a href="{{ url_for('show_shifts') }}" 
             class="nav-link flex items-center gap-3 font-medium">
            <span class="text-lg">üïê</span> Services
          </a>
          <a href="{{ url_for('assignments') }}" 
             class="nav-link flex items-center gap-3 font-medium">
            <span class="text-lg">üìã</span> Assignations
          </a>
        {% endif %}
        <a href="{{ url_for('settings') }}" 
           class="nav-link flex items-center gap-3 font-medium">
          <span class="text-lg">‚öôÔ∏è</span> Param√®tres
        </a>
      {% else %}
        <a href="{{ url_for('login') }}" 
           class="nav-link flex items-center gap-3 font-medium">
          <span class="text-lg">üîë</span> Connexion
        </a>
        <a href="{{ url_for('register') }}" 
           class="nav-link flex items-center gap-3 font-medium">
          <span class="text-lg">üìù</span> Inscription
        </a>
      {% endif %}
    </nav>

    {% if current_user.is_authenticated %}
    <div class="p-2 border-t border-gray-200 mt-auto">
      <div class="user-profile flex items-center gap-3 p-3 rounded-xl card bg-white !border-none">
        <div class="w-10 h-10 bg-maihlili-500 rounded-full flex items-center justify-center text-white text-sm font-bold">
          {{ current_user.username[0].upper() }}
        </div>
        <div class="flex-1">
          <p class="text-sm font-semibold text-gray-800">{{ current_user.username }}</p>
          <p class="text-xs text-gray-500">
            {% if current_user.is_admin %}‚ö° Administrateur
            {% elif current_user.is_manager %}üëë Manager
            {% else %}üë§ Employ√©{% endif %}
          </p>
        </div>
      </div>
      <a href="{{ url_for('logout') }}" 
         class="nav-link flex items-center gap-3 p-2 rounded-lg text-sm mt-3 font-medium">
        <span class="text-base">üö™</span> D√©connexion
      </a>
    </div>
    {% endif %}
  </aside>

  <main class="flex-1 p-8">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mb-6 space-y-3">
            {% for category, message in messages %}
                <div class="flash-message border-l-4 border-maihlili-500 p-4 rounded-xl shadow-sm bg-white" role="alert">
                    <p class="font-medium text-maihlili-700">{{ message }}</p>
                </div>
            {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </main>

  <button class="theme-toggle fixed bottom-6 right-6 p-4 rounded-full text-2xl cursor-pointer shadow-lg z-50 transition-all duration-300 ease-in-out bg-gray-200 text-gray-800 hover:bg-gray-300" id="themeToggle">
    üåô
  </button>

  <script>
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;
    
    // R√©cup√©rer le th√®me sauvegard√©
    const savedTheme = localStorage.getItem('maihlili-theme') || 'light';
    body.setAttribute('data-theme', savedTheme);
    updateThemeToggle(savedTheme);
    
    function toggleTheme() {
      const currentTheme = body.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      
      body.setAttribute('data-theme', newTheme);
      localStorage.setItem('maihlili-theme', newTheme);
      updateThemeToggle(newTheme);
    }
    
    function updateThemeToggle(theme) {
      if (theme === 'light') {
        themeToggle.textContent = 'üåô';
        themeToggle.title = 'Passer en mode sombre';
        // R√®gle Tailwind pour mode clair (couleurs neutres)
        themeToggle.className = 'theme-toggle fixed bottom-6 right-6 p-4 rounded-full text-2xl cursor-pointer shadow-lg z-50 transition-all duration-300 ease-in-out bg-gray-200 text-gray-800 hover:bg-gray-300';
      } else {
        themeToggle.textContent = '‚òÄÔ∏è';
        themeToggle.title = 'Passer en mode clair';
        // R√®gle Tailwind pour mode sombre (couleur Maihlili)
        themeToggle.className = 'theme-toggle fixed bottom-6 right-6 p-4 rounded-full text-2xl cursor-pointer shadow-lg z-50 transition-all duration-300 ease-in-out bg-maihlili-500 text-white hover:bg-maihlili-600';
      }
    }

    themeToggle.addEventListener('click', toggleTheme);

    document.addEventListener('DOMContentLoaded', function() {
      const currentPath = window.location.pathname;
      const navLinks = document.querySelectorAll('.nav-link');
      
      navLinks.forEach(link => {
        // Nettoyage des classes actives (le CSS g√®re l'ajout de 'active')
        link.classList.remove('active');

        if (link.getAttribute('href') === currentPath) {
          link.classList.add('active');
        }
      });
    });
  </script>
</body>
</html>
