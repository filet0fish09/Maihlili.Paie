<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Maihlili Paie</title> <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            // Couleurs exactes du logo Maihlili (bleu pur)
            'maihlili': {
              50: '#EEF2FF',
              100: '#E0E7FF', 
              200: '#C7D2FE',
              300: '#A5B4FC',
              400: '#818CF8',
              500: '#4F46E5', // Bleu exact de votre logo
              600: '#4338CA', 
              700: '#3730A3',
              800: '#312E81',
              900: '#1E1B4B'
            },
            'nouveau-bleu': {
                50: '#E6E9FF',
                100: '#C8CEFF',
                200: '#AAAEFF',
                300: '#8C8FFF',
                400: '#6E71FF',
                500: '#3055ff', // Le nouveau bleu
                600: '#2A4CE5',
                700: '#2343CC',
                800: '#1D3AAA',
                900: '#163188'
            }
          }
        }
      }
    }
  </script>
  <style>
    /* -------------------------------------------------------------------------------------------------- */
    /* Couleurs & Thème Maihlili Paie - AMÉLIORATION DU MODE SOMBRE POUR LA LISIBILITÉ                    */
    /* -------------------------------------------------------------------------------------------------- */
    :root {
      /* Couleurs Claires */
      --color-bg-light: #f9fafb;
      --color-text-light: #1f2937;
      --color-text-subtle-light: #6b7280;
      --color-border-light: #e5e7eb;
      --color-card-bg-light: #fff0f8; /* Garde la couleur de carte originale de l'ancien design */
      --color-sidebar-bg-light: #ffffff;
    }

    /* Variables pour le Mode Sombre - Nettoyé */
    [data-theme="dark"] {
      --color-bg-dark: #111827; /* Fond principal très sombre */
      --color-text-dark: #f9fafb;
      --color-text-subtle-dark: #9ca3af;
      --color-border-dark: #374151; /* Bordures sombres */
      --color-card-bg-dark: #1f2937; /* Fond des cartes/panneaux */
      --color-sidebar-bg-dark: #1f2937; /* Fond de la sidebar (uniforme avec les cartes) */
      --color-input-bg-dark: #374151; /* Fond des inputs */
      --color-input-border-dark: #4b5563;
      
      /* Les anciennes variables sont mises à jour pour la cohérence */
      --color-bg-dark-dashboard: #111827;
      --color-text-dark-dashboard: #f9fafb;
      --color-text-subtle-dark-dashboard: #9ca3af;
      --color-border-dark-dashboard: #374151;
      --color-card-bg-dark-dashboard: #1f2937;
      --color-bg-dark-sidebar: #1f2937;
      --color-text-dark-sidebar: #f9fafb;
      --color-text-subtle-dark-sidebar: #c7d2fe;
      --color-border-dark-sidebar: #374151;
      --color-card-bg-dark-sidebar: #2d3748;
    }

    body {
      background-color: var(--color-bg-light);
      color: var(--color-text-light);
      transition: background-color 0.4s ease, color 0.4s ease;
    }
    
    /* Mode sombre : body */
    [data-theme="dark"] body {
      background-color: var(--color-bg-dark);
      color: var(--color-text-dark);
    }
    
    .card {
      background-color: var(--color-card-bg-light);
      border: 1px solid var(--color-border-light);
      transition: background-color 0.4s ease, border-color 0.4s ease, box-shadow 0.2s ease;
    }

    /* Styles pour la zone de contenu principale en mode sombre */
    [data-theme="dark"] main {
        background-color: transparent; 
        color: var(--color-text-dark);
    }
    
    /* Correction pour les cartes et éléments 'bg-white' dans le dashboard */
    [data-theme="dark"] main .bg-white,
    [data-theme="dark"] .card {
        background-color: var(--color-card-bg-dark) !important;
        border-color: var(--color-border-dark) !important;
        box-shadow: none !important; /* Retrait des ombres trop flashy */
    }
    
    /* Styles pour la sidebar en mode sombre - FOND SOMBRE ET UNIFORME */
    [data-theme="dark"] aside {
        background: var(--color-sidebar-bg-dark) !important;
        color: var(--color-text-dark-sidebar);
        border-color: var(--color-border-dark) !important;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.4) !important; /* Ombre discrète */
    }
    
    /* Le 'user-profile' dans la sidebar est une carte plus foncée pour le contraste */
    [data-theme="dark"] aside .user-profile.card {
        background-color: var(--color-input-bg-dark) !important; 
        border: 1px solid var(--color-border-dark) !important;
    }

    /* Couleurs du texte, bordures et dividers en mode sombre pour la lisibilité */
    [data-theme="dark"] main .text-gray-800,
    [data-theme="dark"] main h1,
    [data-theme="dark"] main h2,
    [data-theme="dark"] main h3 { color: var(--color-text-dark) !important; }

    [data-theme="dark"] main .text-gray-500 { color: var(--color-text-subtle-dark) !important; }
    [data-theme="dark"] main .border-gray-200,
    [data-theme="dark"] main .border-gray-300 { border-color: #4B5563 !important; }
    [data-theme="dark"] main .divide-gray-200 > * + * { border-color: #4B5563 !important; }
    
    /* Tables plus lisibles */
    [data-theme="dark"] main .bg-gray-50 { 
        background-color: #2d3748 !important; /* Header de table */
        color: #F3F4F6 !important;
    }
    
    [data-theme="dark"] main .hover\:bg-gray-50:hover { 
        background-color: #374151 !important; /* Hover plus foncé */
    }
    
    /* Inputs et selects plus lisibles */
    [data-theme="dark"] main input, 
    [data-theme="dark"] main select, 
    [data-theme="dark"] main textarea {
        background-color: var(--color-input-bg-dark) !important;
        border-color: var(--color-input-border-dark) !important;
        color: var(--color-text-dark) !important;
    }
    
    [data-theme="dark"] main input:focus,
    [data-theme="dark"] main select:focus,
    [data-theme="dark"] main textarea:focus {
        border-color: #4F46E5 !important;
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.4) !important;
        background-color: #374151 !important;
    }
    
    /* Flash messages plus lisibles */
    [data-theme="dark"] .bg-gradient-to-r.from-maihlili-100.to-maihlili-50 {
        background: #374151 !important; 
        border-color: #4F46E5 !important; 
        color: #E0E7FF !important; 
    }
    
    /* Liens de navigation plus visibles */
    [data-theme="dark"] .nav-link {
        color: #E0E7FF !important;
        transition: all 0.2s ease !important;
    }
    
    /* Hover de lien plus visible */
    [data-theme="dark"] aside .nav-link:hover {
        background-color: rgba(79, 70, 229, 0.1) !important;
        color: #FFFFFF !important;
        transform: none !important; /* Retrait de l'animation de translation */
    }
    
    /* Lien actif */
    [data-theme="dark"] .nav-link.bg-maihlili-100 {
        background-color: #4338CA !important; 
        color: #FFFFFF !important;
    }

    /* Retrait de l'animation de transformation sur tous les éléments */
    * { 
      transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease !important; 
    } 

    /* Scrollbar simplifiée pour le mode sombre */
    [data-theme="dark"] ::-webkit-scrollbar-thumb { 
        background: #4F46E5 !important; 
    }
    
    [data-theme="dark"] ::-webkit-scrollbar-thumb:hover { 
        background: #6366F1 !important; 
    }
    [data-theme="dark"] ::-webkit-scrollbar-track { 
        background: #111827 !important; 
    }

    /* Toggle theme button amélioré */
    [data-theme="dark"] .theme-toggle {
        background: #4F46E5 !important; /* Fond bleu uni */
        border: none !important;
        box-shadow: 0 4px 12px rgba(79, 70, 229, 0.4) !important;
        color: #E0E7FF;
    }
    
    [data-theme="dark"] .theme-toggle:hover {
        transform: translateY(-1px) !important;
        box-shadow: 0 8px 24px rgba(79, 70, 229, 0.5) !important;
    }
  </style>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/main.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 flex min-h-screen" data-theme="light">

  <aside class="w-64 card shadow-lg flex flex-col">
    <div class="p-6 border-b border-gray-200">
      <div class="flex items-center justify-center">
        <a href="{{ url_for('index') }}" class="flex items-center space-x-2">
          <img src="{{ url_for('static', filename='images/maihlili-logo-light.png') }}" alt="Logo Maihlili clair" class="h-32 logo-light">
          <img src="{{ url_for('static', filename='images/maihlili-logo-dark.png') }}" alt="Logo Maihlili sombre" class="h-32 logo-dark">
        </a>
      </div>
    </div>
    
    <nav class="flex-1 p-4 space-y-1">
      {% if current_user.is_authenticated %}
        <a href="{{ url_for('index') if current_user.is_manager else url_for('employee_dashboard') }}" 
           class="nav-link flex items-center gap-3 p-3 rounded-lg hover:bg-maihlili-50 hover:text-maihlili-700 text-maihlili-600 font-medium">
           <span class="text-lg">📊</span> Tableau de bord
        </a>
         {% if current_user.is_manager %}
          <a href="{{ url_for('planning') }}" 
             class="nav-link flex items-center gap-3 p-3 rounded-lg hover:bg-indigo-50 hover:text-indigo-700 text-indigo-600 font-medium">
            <span class="text-lg">📅</span> Planning Avancé
          </a>
          
          <a href="{{ url_for('show_employees') }}" 
             class="nav-link flex items-center gap-3 p-3 rounded-lg hover:bg-green-50 hover:text-green-700 text-green-600 font-medium">
            <span class="text-lg">👥</span> Employés
          </a>
          <a href="{{ url_for('manage_teams') }}" 
             class="nav-link flex items-center gap-3 p-3 rounded-lg hover:bg-blue-50 hover:text-blue-700 text-blue-600 font-medium">
            <span class="text-lg">🏢</span> Équipes
          </a>
          <a href="{{ url_for('show_shifts') }}" 
             class="nav-link flex items-center gap-3 p-3 rounded-lg hover:bg-purple-50 hover:text-purple-700 text-purple-600 font-medium">
            <span class="text-lg">🕐</span> Services
          </a>
          <a href="{{ url_for('assignments') }}" 
             class="nav-link flex items-center gap-3 p-3 rounded-lg hover:bg-orange-50 hover:text-orange-700 text-orange-600 font-medium">
            <span class="text-lg">📋</span> Assignations
          </a>
        {% endif %}
        <a href="{{ url_for('settings') }}" 
           class="nav-link flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 hover:text-gray-700 text-gray-600 font-medium">
          <span class="text-lg">⚙️</span> Paramètres
        </a>
      {% else %}
        <a href="{{ url_for('login') }}" 
           class="nav-link flex items-center gap-3 p-3 rounded-lg hover:bg-maihlili-50 hover:text-maihlili-700 text-maihlili-600 font-medium">
          <span class="text-lg">🔑</span> Connexion
        </a>
        <a href="{{ url_for('register') }}" 
           class="nav-link flex items-center gap-3 p-3 rounded-lg hover:bg-green-50 hover:text-green-700 text-green-600 font-medium">
          <span class="text-lg">📝</span> Inscription
        </a>
      {% endif %}
    </nav>

    {% if current_user.is_authenticated %}
    <div class="p-4 border-t border-gray-200">
      <div class="user-profile flex items-center gap-3 p-3 rounded-lg card">
        <div class="w-10 h-10 bg-gradient-to-br from-maihlili-500 to-maihlili-600 rounded-full flex items-center justify-center text-white text-sm font-bold shadow-md">
          {{ current_user.username[0].upper() }}
        </div>
        <div class="flex-1">
          <p class="text-sm font-semibold text-gray-800">{{ current_user.username }}</p>
          <p class="text-xs text-gray-500">
            {% if current_user.is_admin %}⚡ Administrateur
            {% elif current_user.is_manager %}👑 Manager
            {% else %}👤 Employé{% endif %}
          </p>
        </div>
      </div>
      <a href="{{ url_for('logout') }}" 
         class="nav-link flex items-center gap-3 p-2 rounded-lg hover:bg-red-50 hover:text-red-700 text-red-600 text-sm mt-3 font-medium">
        <span class="text-base">🚪</span> Déconnexion
      </a>
    </div>
    {% endif %}
  </aside>

  <main class="flex-1 p-6">
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul class="mb-4">
          {% for msg in messages %}
            <li class="bg-gradient-to-r from-maihlili-100 to-maihlili-50 border border-maihlili-200 text-maihlili-700 px-4 py-3 rounded-lg mb-2 shadow-sm">
              <span class="font-medium">ℹ️</span> {{ msg }}
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </main>

  <button class="theme-toggle" id="themeToggle">
    🌙
  </button>

  <script>
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;
    
    // Récupérer le thème sauvegardé
    const savedTheme = localStorage.getItem('maihlili-theme') || 'light';
    body.setAttribute('data-theme', savedTheme);
    updateThemeToggle(savedTheme);
    
    function toggleTheme() {
      const currentTheme = body.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      
      body.setAttribute('data-theme', newTheme);
      localStorage.setItem('maihlili-theme', newTheme);
      updateThemeToggle(newTheme);
    }
    
    function updateThemeToggle(theme) {
      if (theme === 'light') {
        themeToggle.textContent = '🌙';
        themeToggle.title = 'Passer en mode sombre';
      } else {
        themeToggle.textContent = '☀️';
        themeToggle.title = 'Passer en mode clair';
      }
    }

    themeToggle.addEventListener('click', toggleTheme);

    document.addEventListener('DOMContentLoaded', function() {
      const currentPath = window.location.pathname;
      const navLinks = document.querySelectorAll('.nav-link');
      
      navLinks.forEach(link => {
        // Nettoyer les classes actives avant de vérifier
        link.classList.remove('bg-maihlili-100', 'text-maihlili-800', 'shadow-sm');
        
        if (link.getAttribute('href') === currentPath) {
          link.classList.add('bg-maihlili-100', 'text-maihlili-800', 'shadow-sm');
        }
      });
      // Correction: La couleur du texte doit être adaptée au thème
      const activeLink = document.querySelector('.nav-link.bg-maihlili-100');
      if (activeLink) {
        if (body.getAttribute('data-theme') === 'dark') {
          activeLink.classList.remove('text-maihlili-800');
          activeLink.classList.add('text-white');
        } else {
          activeLink.classList.remove('text-white');
          activeLink.classList.add('text-maihlili-800');
        }
      }
    });
  </script>
</body>
</html>
