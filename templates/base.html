<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Maihlili SPV</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
  <style>
    /* NOUVEAUX STYLES POUR LES EMOJIS */
    .emoji-container {
        font-size: 1.5rem; /* Taille de l'emoji */
        line-height: 1;
        width: 1.5rem; /* Assure un espace constant */
        height: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    /* Styles pour la barre de navigation */
    .nav-link-group {
        display: flex;
        align-items: center;
        gap: 0.75rem; /* 12px d'espace entre l'icône et le label */
        width: 100%;
        height: 50px;
        text-decoration: none;
        padding-left: 0.5rem; /* Espace pour l'emoji */
    }
    
    /* ************************************************************ */
    /* NOUVEAUX STYLES LIQUID GLASS / COULEURS INVERSÉES            */
    /* ************************************************************ */

    /* Style par défaut du label (Blanc Cassé sur fond Rose Sidebar) */
    .liquid-glass-label {
        flex-grow: 1; 
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: flex-start;
        padding: 0 1.5rem;
        border-radius: 50px; /* ARRONDI: 50px */
        color: #3055ff; /* Texte bleu sur fond clair */
        font-weight: 500;
        text-align: left;
        
        /* Styles Liquid Glass par défaut (Fond blanc cassé/rose très clair) */
        background-color: #fff; /* Blanc pur pour l'élément inactif */
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        backdrop-filter: blur(2px);
        -webkit-backdrop-filter: blur(2px);
        border: 1px solid rgba(255, 255, 255, 0.9); 
        transition: all 0.2s ease;
    }
    
    /* Style de l'élément sélectionné (Bleu Maihlili) */
    .liquid-glass-selected .liquid-glass-label {
        background-color: #3055ff !important; /* NOUVEAU: Bleu Maihlili */
        color: white !important; /* NOUVEAU: Texte blanc sur fond bleu */
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        border: 1px solid #3055ff !important;
    }

    /* Le style de l'icône sélectionnée devient blanc (pour l'harmonie) */
    .liquid-glass-selected .emoji-container {
        color: white; /* NOTE: Les emojis n'ont pas de couleur de texte/stroke, mais on garde la classe pour l'homogénéité si on repasse aux SVG */
    }

    /* Ajustement de l'icône Déconnexion */
    .logout-button {
      background-color: #FFDCE4; /* Rose clair pour le bouton Déconnexion */
      color: #3055ff; /* Texte bleu */
    }
    .logout-button:hover {
      background-color: #FFC0CB; /* Rose plus prononcé au hover */
    }

  </style>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            // Couleurs exactes du logo Maihlili (bleu pur)
            'maihlili': {
              50: '#EEF2FF',
              100: '#E0E7FF', 
              200: '#C7D2FE',
              300: '#A5B4FC',
              400: '#818CF8',
              500: '#4F46E5', // Bleu exact de votre logo
              600: '#4338CA', 
              700: '#3730A3',
              800: '#312E81',
              900: '#1E1B4B'
            },
            'nouveau-bleu': {
                50: '#E6E9FF',
                100: '#C8CEFF',
                200: '#AAAEFF',
                300: '#8C8FFF',
                400: '#6E71FF',
                500: '#3055ff', // Le nouveau bleu
                600: '#2A4CE5',
                700: '#2343CC',
                800: '#1D3AAA',
                900: '#163188'
            },
            // NOUVELLES COULEURS POUR LE STYLE FIGMA
            'maihlili-figma-blue': { 
                DEFAULT: '#3055ff', // Utilisation de votre 'nouveau-bleu-500'
            },
            'maihlili-figma-rose': { 
                DEFAULT: '#FFDCE4', // Rose clair pour les éléments inactifs/boutons
                sidebar: '#fff0f8', // Fond de sidebar (simule le rose très pâle)
            },
          }
        }
      }
    }
  </script>
  <style>
    /* -------------------------------------------------------------------------------------------------- */
    /* Couleurs & Thème Maihlili SPV                                                                       */
    /* -------------------------------------------------------------------------------------------------- */
    :root {
      /* Couleurs Claires */
      --color-bg-light: white; /* NOUVEAU: Fond de MAIN en blanc */
      --color-text-light: #1f2937;
      --color-text-subtle-light: #6b7280;
      --color-border-light: #e5e7eb;
      --color-card-bg-light: white; /* NOUVEAU: Cartes en blanc */
      
      /* COULEUR DE FOND DE SIDEBAR - ROSE MAIHLILI */
      --color-sidebar-bg-light: #fff0f8; /* Rose Maihlili */
    }
    
    /* CORRECTION DU FOND DE PAGE ET DE MAIN */
    body {
      background-color: var(--color-sidebar-bg-light); /* Le fond du BODY est le rose */
    }

    main {
      background-color: var(--color-bg-light); /* Le contenu principal est le blanc */
    }

    [data-theme="dark"] {
      /* Couleurs Sombres pour le tableau de bord uniquement */
      --color-bg-dark-dashboard: #1f2937;
      --color-text-dark-dashboard: #f9fafb;
      --color-text-subtle-dark-dashboard: #9ca3af;
      --color-border-dark-dashboard: #374151;
      --color-card-bg-dark-dashboard: #2d3748;
      
      /* Couleurs pour la sidebar en mode sombre (maintenues) */
      --color-bg-dark-sidebar: #3055ff;
      --color-text-dark-sidebar: #f9fafb;
      --color-text-subtle-dark-sidebar: #c7d2fe;
      --color-border-dark-sidebar: rgba(255, 255, 255, 0.1);
      --color-card-bg-dark-sidebar: #2a4ce5;
    }

    /* Styles pour la zone de contenu principale en mode sombre */
    [data-theme="dark"] main {
        background-color: var(--color-bg-dark-dashboard);
        color: var(--color-text-dark-dashboard);
    }
    
    /* Correction pour les cartes et éléments 'bg-white' dans le dashboard */
    [data-theme="dark"] main .bg-white {
        background-color: var(--color-card-bg-dark-dashboard);
        border-color: var(--color-border-dark-dashboard);
    }
    
    /* NOUVEAU STYLE SIDEBAR CLAIR: Fond Rose, pas de bordure ni d'ombre */
    aside {
        background: var(--color-sidebar-bg-light) !important; 
        box-shadow: none !important; 
        border: none !important;
        border-radius: 50px !important; /* Bords arrondis de la sidebar */
    }
    
    /* Conteneur principal de la sidebar (celui qui prend tout l'espace) */
    .sidebar-main-content {
      background-color: #fff0f8 !important; /* Fond rose clair */
    }
    
    /* Conteneur du logo - doit rester bleu */
    .logo-container {
      background-color: #3055ff !important;
    }

    /* ------------------- (Reste du CSS non modifié) ------------------- */
    
    /* Couleurs du texte dans le contenu principal */
    [data-theme="dark"] main .text-gray-800 { color: var(--color-text-dark-dashboard); }
    [data-theme="dark"] main .text-gray-500 { color: var(--color-text-subtle-dark-dashboard); }
    [data-theme="dark"] main .border-gray-200 { border-color: var(--color-border-dark-dashboard); }
    
    /* Couleurs du texte dans la sidebar */
    [data-theme="dark"] aside .text-gray-800 { color: var(--color-text-dark-sidebar); }
    [data-theme="dark"] aside .text-gray-500 { color: var(--color-text-subtle-dark-sidebar); }
    [data-theme="dark"] aside .border-gray-200 { border-color: var(--color-border-dark-sidebar); }

    /* -------------------------------------------------------------------------------------------------- */
    /* AMÉLIORATIONS MODE SOMBRE - LISIBILITÉ ACCRUE (maintenues)                                         */
    /* -------------------------------------------------------------------------------------------------- */
    
    /* ... (CSS mode sombre non modifié) ... */
    
    /* -------------------------------------------------------------------------------------------------- */
    /* NOUVEAUX STYLES FIGMA / LIQUID GLASS                                                               */
    /* -------------------------------------------------------------------------------------------------- */
    
    .font-['Bebas_Neue'] {
        font-family: 'Bebas Neue', cursive;
    }

    [data-theme="dark"] aside {
        background: #3055ff !important; 
        color: white !important;
        border-color: rgba(255, 255, 255, 0.1) !important;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3) !important;
    }
    
    /* -------------------------------------------------------------------------------------------------- */
    /* Logos                                                                                              */
    /* -------------------------------------------------------------------------------------------------- */
    .logo-dark { display: none; }
    .logo-light { display: inline-block; }
    [data-theme="dark"] .logo-light { display: none; }
    [data-theme="dark"] .logo-dark { display: inline-block; }

    /* -------------------------------------------------------------------------------------------------- */
    /* Animations & Scrollbar (maintenues)                                                                */
    /* -------------------------------------------------------------------------------------------------- */
    * { transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, transform 0.2s ease !important; }
    
    /* ... (CSS scrollbar et toggle button non modifié) ... */
    
  </style>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/main.min.css" rel="stylesheet">
</head>
<body class="bg-[#fff0f8] flex min-h-screen" data-theme="light"> 

  <aside class="w-[320px] p-3 flex flex-col bg-maihlili-figma-rose-sidebar" style="min-height: 100vh;"> <div class="h-[140px] rounded-[50px] bg-maihlili-figma-blue flex items-center p-4 shadow-xl logo-container"> <div class="w-[110px] h-[110px] rounded-full bg-white flex items-center justify-center -translate-y-1 shadow-xl">
        <img src="{{ url_for('static', filename='images/maihlili-logo-light.png') }}" alt="Logo Maihlili clair" class="h-24 w-24 rounded-full">
      </div>
      <div class="ml-3 flex flex-col leading-none text-white font-['Bebas_Neue'] uppercase">
        <span class="text-3xl tracking-widest -mb-1">Maihlili.</span>
        <span class="text-3xl tracking-widest">Paie</span>
      </div>
    </div>

    <div class="flex-1 mt-3 p-4 rounded-[50px] bg-maihlili-figma-rose-sidebar flex flex-col justify-between shadow-2xl sidebar-main-content"> <nav class="space-y-2">
        {% if current_user.is_authenticated %}
          {% set menu_items_data = [
            ('📊', 'Planning', url_for('index') if current_user.is_manager else url_for('employee_dashboard'), current_user.is_authenticated),
            ('📅', 'Planning Avancé', url_for('planning'), current_user.is_manager),
            ('👥', 'Employés', url_for('show_employees'), current_user.is_manager),
            ('🏢', 'Équipes', url_for('manage_teams'), current_user.is_manager),
            ('⏱️', 'Services', url_for('show_shifts'), current_user.is_manager),
            ('📋', 'Assignations', url_for('assignments'), current_user.is_manager),
            ('⚙️', 'Paramètres', url_for('settings'), current_user.is_authenticated)
          ] %}

          {% for emoji, label, url, condition in menu_items_data %}
            {% if condition %}
            <a href="{{ url }}" 
               class="nav-link-group {% if loop.index == 1 %} liquid-glass-selected {% endif %}"> 
              
              <span class="emoji-container text-maihlili-figma-blue">{{ emoji | safe }}</span> <span class="liquid-glass-label text-lg font-['Bebas_Neue'] uppercase tracking-wider">{{ label }}</span> 
            </a>
            {% endif %}
          {% endfor %}
        
        {% else %}
          <a href="{{ url_for('login') }}" 
             class="nav-link-group">
            <span class="emoji-container text-maihlili-figma-blue">🔑</span>
            <span class="liquid-glass-label text-lg font-['Bebas_Neue'] uppercase tracking-wider">Connexion</span>
          </a>
          <a href="{{ url_for('register') }}" 
             class="nav-link-group">
            <span class="emoji-container text-maihlili-figma-blue">📝</span>
            <span class="liquid-glass-label text-lg font-['Bebas_Neue'] uppercase tracking-wider">Inscription</span>
          </a>
        {% endif %}
      </nav>
      
      <div class="mt-4 space-y-2"> 
        
        {% if current_user.is_authenticated %}
        <div class="user-profile flex items-center p-3 rounded-[50px] bg-white shadow-inner" style="height: 65px; border: 1px solid rgba(255, 255, 255, 0.9);"> <div class="w-10 h-10 bg-maihlili-figma-rose rounded-full flex items-center justify-center text-xl font-bold shadow-lg">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-maihlili-figma-blue">
              <path stroke-linecap="round" stroke-linejoin="round" d="M17.982 4.743A9.522 9.522 0 0 0 12 3.5c-4.972 0-9 4.028-9 9s4.028 9 9 9 9-4.028 9-9c0-.448-.046-.889-.138-1.32" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 12a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M15.406 20.088c-1.691-.715-3.593-1.088-5.406-1.088-1.813 0-3.715.373-5.406 1.088a1.5 1.5 0 0 0-.844 1.341c0 .828.672 1.5 1.5 1.5h9.75a1.5 1.5 0 0 0 1.5-1.5 1.5 1.5 0 0 0-.844-1.341Z" />
            </svg>
          </div>
          <div class="flex-1 ml-3 text-maihlili-figma-blue">
            <p class="text-xl font-['Bebas_Neue'] uppercase tracking-wider text-maihlili-figma-blue">{{ current_user.username }}</p> 
            <p class="text-xs font-light -mt-1 text-gray-700">
              {% if current_user.is_admin %}Administrateur
              {% elif current_user.is_manager %}Manager
              {% else %}Employé{% endif %}
            </p>
          </div>
        </div>
        
        <a href="{{ url_for('logout') }}" 
           class="flex items-center justify-center p-3 rounded-[50px] bg-maihlili-figma-rose logout-button hover:bg-maihlili-figma-rose-dark backdrop-blur-sm text-maihlili-figma-blue font-['Bebas_Neue'] uppercase text-xl transition-all duration-200"
           style="height: 45px;"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 mr-2 -translate-y-0.5 text-maihlili-figma-blue">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6A2.25 2.25 0 0 0 5.25 5.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l3 3m0 0-3 3m3-3H6" />
          </svg>
          Se Déconnecter
        </a>
        {% endif %}
      </div>
    </div>
  </aside>

  <main class="flex-1 p-6 bg-white"> {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul class="mb-4">
          {% for msg in messages %}
            <li class="bg-gradient-to-r from-maihlili-100 to-maihlili-50 border border-maihlili-200 text-maihlili-700 px-4 py-3 rounded-lg mb-2 shadow-sm">
              <span class="font-medium">ℹ️</span> {{ msg }}
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </main>

  <button class="theme-toggle" id="themeToggle">
    🌙
  </button>

  <script>
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;
    
    // Récupérer le thème sauvegardé
    const savedTheme = localStorage.getItem('maihlili-theme') || 'light';
    body.setAttribute('data-theme', savedTheme);
    updateThemeToggle(savedTheme);
    
    function toggleTheme() {
      const currentTheme = body.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      
      body.setAttribute('data-theme', newTheme);
      localStorage.setItem('maihlili-theme', newTheme);
      updateThemeToggle(newTheme);
    }
    
    function updateThemeToggle(theme) {
      if (theme === 'light') {
        themeToggle.textContent = '🌙';
        themeToggle.title = 'Passer en mode sombre';
      } else {
        themeToggle.textContent = '☀️';
        themeToggle.title = 'Passer en mode clair';
      }
    }

    themeToggle.addEventListener('click', toggleTheme);

    document.addEventListener('DOMContentLoaded', function() {
      const currentPath = window.location.pathname;
      const navLinks = document.querySelectorAll('.nav-link-group'); 

      navLinks.forEach(link => {
        const linkURL = link.getAttribute('href');
        const label = link.querySelector('.liquid-glass-label');
        
        // 1. Gérer la sélection (Bleu)
        if (linkURL === currentPath) {
          link.classList.add('liquid-glass-selected');
        } else {
          link.classList.remove('liquid-glass-selected');
        }

        // 2. Gérer l'effet de survol (plus de changement de couleur sur le label inactif)
        if (label) {
          link.addEventListener('mouseover', function() {
            if (!link.classList.contains('liquid-glass-selected')) {
              label.style.backgroundColor = '#f0f0f0'; /* Légère teinte grise au survol inactif */
            }
          });
          link.addEventListener('mouseout', function() {
            if (!link.classList.contains('liquid-glass-selected')) {
              label.style.backgroundColor = '#fff'; // Revert au blanc pur
            }
          });
        }
      });
    });
  </script>
</body>
</html>
